# JSON Vulnerability to CSV Converter

This script converts JSON vulnerability files to CSV format, preserving all fields in separate columns with proper flattening of nested structures.

## Features

- **Complete Field Preservation**: All JSON fields are converted to CSV columns
- **Nested Structure Flattening**: Properly handles nested objects and arrays
- **Interactive File Selection**: Prompts user to select from available JSON files
- **CSV Output**: Creates clean CSV files with summary documentation
- **Column Analysis**: Optional column information display
- **Error Handling**: Comprehensive error handling and user feedback
- **Universal Compatibility**: CSV format works with Excel, Google Sheets, and any data analysis tool

## Installation

1. Install required dependencies:
```bash
pip install -r requirements.txt
```

## Usage

### Interactive Mode (Recommended)
```bash
python json_to_spreadsheet_converter.py
```

The script will:
1. Show available JSON files in the current directory
2. Let you select a file or enter a custom path
3. Automatically generate an output filename
4. Process the file and create an Excel spreadsheet

### Command Line Mode
```bash
# Specify input file
python json_to_spreadsheet_converter.py --input vulnerability-data.json

# Specify both input and output files
python json_to_spreadsheet_converter.py --input data.json --output report.csv

# Show column information after processing
python json_to_spreadsheet_converter.py --input data.json --show-columns
```

### Command Line Options

| Option | Description |
|--------|-------------|
| `--input`, `-i` | Input JSON file path |
| `--output`, `-o` | Output CSV file path |
| `--show-columns` | Display column information after processing |
| `--help`, `-h` | Show help message |

## Output Format

The script creates two files:

### 1. Main CSV File
- Contains all vulnerability records with flattened fields
- Each nested JSON field becomes a separate column
- Arrays are handled intelligently:
  - String arrays: Joined with semicolons
  - Object arrays: Each object gets separate columns with indices
  - Mixed arrays: Converted to string representation
- UTF-8 encoding for universal compatibility

### 2. Summary Text File (filename_summary.txt)
- Processing statistics and metadata
- Total vulnerabilities processed and column count
- Column information with data coverage percentages
- Sample values for each column
- Generation timestamp and source file information

## JSON Structure Support

The script expects JSON files with the following structure:
```json
{
    "content": [
        {
            "id": "vulnerability-id",
            "name": "Vulnerability Name",
            "referenceIds": [...],
            "cwes": [...],
            "stats": {
                "risk": 984,
                "findingTypes": [...],
                ...
            }
        }
    ]
}
```

## Column Naming Convention

Nested fields are flattened using underscore separation:
- `stats.risk` becomes `stats_risk`
- `stats.findingStats.critical` becomes `stats_findingStats_critical`
- Array items get indexed: `referenceIds_0_id`, `referenceIds_1_id`

## Examples

### Processing a vulnerability file:
```bash
python json_to_spreadsheet_converter.py --input Vulnerability-sample-list-h-app.json
```

Output: `Vulnerability-sample-list-h-app_vulnerability_report.csv`

### Custom output filename:
```bash
python json_to_spreadsheet_converter.py \
    --input vulnerability-data.json \
    --output security_vulnerabilities_2025.csv
```

## Error Handling

The script includes comprehensive error handling for:
- Invalid JSON format
- Missing files
- Malformed data structures
- Processing errors
- File write permissions

## Performance

- Efficiently processes large JSON files
- Memory-conscious processing
- Progress indicators for large datasets
- Optimized Excel output with proper formatting

## Troubleshooting

### Common Issues

1. **File not found**: Ensure the JSON file path is correct
2. **Invalid JSON**: Check that the JSON file is properly formatted
3. **Permission errors**: Ensure write permissions for the output directory
4. **Memory issues**: For very large files, consider processing in chunks
5. **CSV encoding**: Files are saved in UTF-8 encoding for maximum compatibility

### Getting Help

Run with `--help` to see all available options:
```bash
python json_to_spreadsheet_converter.py --help
```

## Requirements

- Python 3.7+
- pandas >= 1.5.0

## License

Part of the Phoenix Security Configuration System.
